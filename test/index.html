<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Picante Pequin Salsa Co.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
  <link rel="preload" as="image" href="https://picantepequinsalsaco.com/images/bg.png" />

  <style>
    :root {
      --bg-deep:        #1e1e1e00;
      --ink:            #ececec;
      --muted:          #b0b0b0;
      --accent-orange:  #f57c00;
      --accent-green:   #558b2f;
      --accent-red:     #d84315;
      --card:           #2e2e2e60;
      --card-border:    #3a3a3a;
      --row-alt:        #262626;
      --button-opq:     #ffffff2f;
      --radius-sm:      12px;
      --shadow:         0 10px 30px #00000066;
      --accent-glow:    0 0 0 2px #f57c0033, 0 10px 20px #f57c0022;
      --maxw:           1100px;
      --cart-width:     80vw;
      --login-width:    60vw;
      --cart-max-width: 400px;
    }

    * { box-sizing: border-box; }
    html, body {
      margin: 0; padding: 0;
      font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-deep);
      scroll-behavior: smooth;
      color: var(--ink);
    }
    a, button { font: inherit; }
    a { color: inherit; text-decoration: none; }
    img { display: block; max-width: 100%; }

    .bg {
      position: fixed; inset: 0; z-index: -1;
      background: url('https://picantepequinsalsaco.com/images/bg.png') center/cover no-repeat;
      filter: blur(0) saturate(1.05) brightness(.9);
      transform: translateZ(0) scale(1.02);
    }

    header {
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: saturate(140%) blur(10px);
      background: #161616cc; border-bottom:1px solid #ffffff14;
    }
    .nav {
      max-width: var(--maxw); margin:0 auto;
      padding:12px 18px; display:flex;
      align-items:center; justify-content:space-between;
    }
    .brand { display:flex; align-items:center; gap:10px; }
    .logo {
      width:34px; height:34px; border-radius:10px;
      background: url('https://picantepequinsalsaco.com/images/bg.png') center/cover;
      box-shadow: var(--accent-glow);
    }
    .header-info {
      display: flex; align-items:center; gap:12px;
      font-size:0.9rem;
    }
    .header-info strong { font-weight:700; }
    nav ul {
      display:flex; gap:10px; list-style:none; margin:0; padding:0;
    }
    .cta {
      background:#050f46a9; color:#c06a00b5;
      font-weight:700; padding:9px 14px; border-radius:999px;
      box-shadow: var(--accent-glow); cursor:pointer;
      border:none; transition:filter .2s;
    }
    .cta:hover { filter:brightness(.95); }
    .cta.logout {
      background: var(--accent-red); color: #fff;
    }

    .vertical-gallery {
      max-width: var(--maxw);
      margin: 20px auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }
    .prod-card {
      background: var(--card);
      border:1px solid var(--card-border);
      border-radius: var(--radius-sm);
      padding:16px; box-shadow:var(--shadow);
      display:flex; flex-direction:column;
    }
    .prod-card img {
      border-radius: var(--radius-sm);
      margin-bottom:12px;
      object-fit:cover;
      aspect-ratio: 1 / 1;
    }
    .prod-name { margin:0 0 8px; font-size:1.2rem; }
    .prod-price { margin:0 0 12px; color:var(--muted); }
    .quantity {
      display:flex; align-items:center; gap:8px; margin-bottom:12px;
    }
    .qty-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width:32px;
      height:32px;
      padding: 0;
      background: var(--button-opq); border: 1px solid var(--accent-orange);
      border-radius: 6px;
      font-size:1.2rem;
      color: #fff;
      cursor:pointer;
    }
    .qty-input {
      width:50px; text-align:center;
      border:1px solid var(--card-border);
      border-radius:var(--radius-sm);
      background: var(--row-alt);
      color: var(--ink);
    }
    .add-to-cart {
      margin-top:auto;
      background: linear-gradient(180deg,var(--accent-green),#4a7c27ef);
      color:#fff; border:solid; border-color: var(--button-opq); padding:10px;
      border-radius: var(--radius-sm);
      font-weight:700; cursor:pointer;
    }

    #cart-container {
      position:fixed; inset:0; top: 60px;
      background: rgba(0,0,0,0.8);
      display:flex; align-items:flex-start; justify-content:flex-end;
      z-index:100;
    }
    #cart-container.open { display:flex; }
    .cart-panel {
      width: var(--cart-width); max-width: var(--cart-max-width);
      height:100vh; background: var(--card);
      transform: translateX(100%); transition:transform .3s ease;
      display:flex; flex-direction:column;
    }
    #cart-container.open .cart-panel {
      transform: translateX(0);
    }
    .cart-header {
      display:flex; align-items:center;
      padding:1rem; border-bottom:1px solid var(--card-border);
    }
    .cart-header h2 {
      flex:1; margin:0; font-size:1.2rem; text-align:center;
    }
    #close-cart {
      background:none; border:none;
      color:var(--ink); font-size:1.5rem; cursor:pointer;
    }
    #close-login {
      background:none; border:none;
      color:var(--ink); font-size:1.5rem; cursor:pointer;
    }
    .cart-content {
      flex:1; overflow:auto; padding:1rem;
    }
    .cart-total {
      display: flex; justify-content: space-between;
      align-items: center; padding: 0.75rem 1rem;
      border-top: 1px solid var(--card-border);
      font-size: 1.1rem;
    }
    #cart-items { list-style:none; margin:0; padding:0; }
    #cart-items li {
      display:flex; align-items:center; justify-content:space-between;
      padding:8px; margin-bottom:8px;
      background:var(--row-alt); border-radius:var(--radius-sm);
      transition:opacity 0.3s ease;
      overflow:hidden; white-space:nowrap;
    }
    #cart-items li.removing { opacity:0; }
    #cart-items li img.cart-thumb {
      flex:0 0 auto; width:32px; height:32px;
      object-fit:cover; border-radius:4px; margin-right:8px;
    }
    #cart-items li .cart-name {
      flex:1 1 auto; margin-right:8px;
      overflow:hidden; text-overflow:ellipsis;
    }
    #cart-items li .cart-quantity {
      display:flex; align-items:center; gap:4px;
    }
    #cart-items li .qty-btn {
      background:rgba(255,255,255,0.1); border:none;
      color:var(--ink); width:28px; height:28px;
      border-radius:6px; font-size:1.2rem; line-height:1;
      cursor:pointer;
    }
    #cart-items li .qty-display {
      min-width:24px; text-align:center; color:var(--ink);
    }
    #checkout-btn {
      margin-top:1rem; width:100%;
      padding:.75rem; border:none; border-radius:4px;
      background:var(--accent-orange); color:#fff;
      font-weight:700; cursor:pointer;
    }
    #checkout-btn[disabled] {
      background:var(--muted); cursor:not-allowed;
    }

    #login-container {
      position:fixed; inset:0; top: 60px;
      background: rgba(0,0,0,0.8);
      display:flex; align-items:flex-start; justify-content:flex-end;
      z-index:100;
    }
    #login-container.open { display:flex; }
    #login-container .cart-panel {
      width: var(--login-width); max-width: var(--cart-max-width);
      height:100vh; background: var(--card);
      transform: translateX(100%); transition:transform .3s ease;
      display:flex; flex-direction:column;
    }
    #login-container.open .cart-panel {
      transform: translateX(0);
    }
    .login-form {
      display:flex; flex-direction:column; padding:1rem;
    }
    .login-form input {
      margin-bottom:12px; padding:8px;
      border:1px solid var(--card-border);
      border-radius:var(--radius-sm);
      background:var(--row-alt); color:var(--ink);
    }
    .login-form button {
      background:var(--accent-green); color:#fff;
      border:none; padding:12px; border-radius:var(--radius-sm);
      cursor:pointer; font-weight:700;
    }

    footer {
      text-align:center; color:var(--muted);
      font-size:.9rem; margin:20px 0;
    }
    .links {
      display:flex; gap:14px; justify-content:center;
      flex-wrap:wrap; margin-top:8px;
    }
    .links a { color:var(--accent-orange); font-weight:700; }

    /* 1. Tablets & small desktops: single-column gallery */
@media (max-width: 960px) {
  .vertical-gallery {
    /* switch from multi-col to full-width items */
    grid-template-columns: 1fr;
    max-width: var(--maxw);
    margin: 0 auto;       /* center it */
  }
}

/* 2. Mobile nav stacking & centering */
@media (max-width: 640px) {
  .nav {
    flex-direction: column;
    align-items: stretch;
    text-align: center;
  }
  .brand {
    justify-content: center;
    margin-bottom: 6px;
  }
  nav ul {
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
  }
  nav ul li {
    display: flex;
    justify-content: center;
    width: 100%;          /* make each nav item full-width */
  }
  nav ul li a,
  nav ul li button {
    width: 100%;
  }
}


/* 3. Respect reduced-motion settings */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation: none !important;
    transition: none !important;
  }
}
  </style>
</head>

<body>
  <div class="bg" aria-hidden="true"></div>

  <header>
    <div class="nav">
      <a class="brand" href="https://picantepequinsalsaco.com">
        <div class="logo" aria-hidden="true"></div>
        <strong>Picante Pequin Salsa Co</strong>
      </a>
      <div class="header-info">
        <span id="username-display">Guest</span>
        <span>Rewards: <strong id="rewards-display">0</strong></span>
      </div>
      <nav aria-label="Primary">
        <ul>
          <li><button id="cart-icon" class="cta" aria-label="Toggle Cart">ðŸ›’</button></li>
          <li><button id="login-btn" class="cta">Login</button></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <section class="vertical-gallery" id="product-gallery"
             role="region" aria-label="Product Catalog">
      <!-- products injected by JS -->
    </section>
  </main>

  <aside id="cart-container" role="dialog" aria-modal="true" aria-label="Shopping Cart">
    <div class="cart-panel">
      <div class="cart-header">
        <button id="close-cart" aria-label="Close cart">Ã—</button>
        <h2>Your Cart</h2>
      </div>
      <div class="cart-content">
        <ul id="cart-items"></ul>
        <div class="cart-total">
          <span>Total:</span>
          <strong>$<span id="cart-total-value">0.00</span></strong>
        </div>
        <button id="checkout-btn" disabled>Sign In to Checkout</button>
      </div>
    </div>
  </aside>

  <aside id="login-container" role="dialog" aria-modal="true" aria-label="Customer Login">
    <div class="cart-panel">
      <div class="cart-header">
        <button id="close-login" aria-label="Close login">Ã—</button>
        <h2>Sign In</h2>
      </div>
      <div class="cart-content">
        <form id="login-form" class="login-form">
          <input type="email" id="login-username"
                 placeholder="Email address" required />
          <input type="password" id="login-password"
                 placeholder="Password" required />
          <button type="submit">Sign In</button>
        </form>
      </div>
    </div>
  </aside>

  <footer>
    Â© <span id="y"></span> Picante Pequin Salsa Co.
    <div class="links">
      <a href="/ShippingPolicy">Shipping &amp; Delivery</a>
      <a href="/PrivacyPolicy">Privacy Policy</a>
    </div>
  </footer>

  <script>
    // update year
    document.getElementById('y').textContent = new Date().getFullYear();

    // ==== CONFIGURE YOUR AUTOMATION ENDPOINTS HERE ====
    const API = {
      // GET user by email+password via Power Automate â†’ returns { firstName, lastName, rewards }
      login:    'https://<YOUR-POWER-AUTOMATE-GET-USER-ENDPOINT>',
      // POST order payload â†’ items + user â†’ Power Automate flow for checkout
      checkout: 'https://<YOUR-POWER-AUTOMATE-CHECKOUT-ENDPOINT>'
    };

    const productsEcom = [
      { id: 'house-pequin',   name: 'House Pequin Salsa',       price: 12, image: 'https://picantepequinsalsaco.com/images/image1.jpg' },
      { id: 'spicy-green',    name: 'Spicy Green Chile Pequin', price: 12, image: 'https://picantepequinsalsaco.com/images/image2.jpg' },
      { id: 'red-hot',        name: 'Red Hot Pepper Pequin',    price: 12, image: 'https://picantepequinsalsaco.com/images/image3.jpg' },
      { id: 'the-crew',       name: 'The Crew',                 price: 36, image: 'https://picantepequinsalsaco.com/images/image4.jpg' }
    ];

    let cart = [];
    let isLoggedIn = false;
    let currentUser = { email: '', name: '', rewards: 0 };

    // DOM refs
    const galleryEl       = document.getElementById('product-gallery');
    const cartOverlay     = document.getElementById('cart-container');
    const cartItemsEl     = document.getElementById('cart-items');
    const checkoutBtn     = document.getElementById('checkout-btn');
    const closeCart       = document.getElementById('close-cart');
    const cartIcon        = document.getElementById('cart-icon');
    const loginBtn        = document.getElementById('login-btn');
    const loginOverlay    = document.getElementById('login-container');
    const closeLogin      = document.getElementById('close-login');
    const loginForm       = document.getElementById('login-form');
    const usernameDisplay = document.getElementById('username-display');
    const rewardsDisplay  = document.getElementById('rewards-display');

    // render products grid
    function renderProducts() {
      galleryEl.innerHTML = '';
      productsEcom.forEach(p => {
        const card = document.createElement('div');
        card.className = 'prod-card';
        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}">
          <h3 class="prod-name">${p.name}</h3>
          <p class="prod-price">$${p.price.toFixed(2)}</p>
          <div class="quantity">
            <button class="qty-btn minus">âˆ’</button>
            <input type="number" class="qty-input" value="0" min="0">
            <button class="qty-btn plus">+</button>
          </div>
          <button class="add-to-cart">Add to Cart</button>
        `;

        const qtyInput = card.querySelector('.qty-input');
        card.querySelector('.minus').onclick = () =>
          qtyInput.value = Math.max(0, +qtyInput.value - 1);
        card.querySelector('.plus').onclick = () =>
          qtyInput.value = +qtyInput.value + 1;

        card.querySelector('.add-to-cart').onclick = () => {
          const qty = +qtyInput.value;
          if (!qty) return;
          addToCart({ ...p, qty });
          qtyInput.value = 0;
          toggleCart(true);
        };

        galleryEl.appendChild(card);
      });
    }

    function addToCart(item) {
      const idx = cart.findIndex(x => x.id === item.id);
      if (idx > -1) cart[idx].qty += item.qty;
      else cart.push(item);
      renderCart();
    }

    function removeFromCart(id) {
      cart = cart.filter(i => i.id !== id);
      renderCart();
    }

    function renderCart() {
      cartItemsEl.innerHTML = '';
      cart.forEach(item => {
        const prod = productsEcom.find(p => p.id === item.id);
        const li = document.createElement('li');
        li.innerHTML = `
          <img src="${prod.image}" class="cart-thumb" alt="${prod.name}">
          <span class="cart-name">${prod.name}</span>
          <div class="cart-quantity">
            <button class="qty-btn minus">âˆ’</button>
            <span class="qty-display">${item.qty}</span>
            <button class="qty-btn plus">+</button>
          </div>
        `;
        li.querySelector('.minus').onclick = () => {
          if (item.qty > 1) {
            item.qty--;
            renderCart();
          } else {
            li.classList.add('removing');
            setTimeout(() => removeFromCart(item.id), 300);
          }
        };
        li.querySelector('.plus').onclick = () => {
          item.qty++;
          renderCart();
        };
        cartItemsEl.appendChild(li);
      });

      const total = cart.reduce((sum, { id, qty }) => {
        const prod = productsEcom.find(p => p.id === id);
        return sum + prod.price * qty;
      }, 0);
      document.getElementById('cart-total-value').textContent = total.toFixed(2);

      checkoutBtn.disabled = !isLoggedIn || cart.length === 0;
      checkoutBtn.textContent = !isLoggedIn
        ? 'Sign In to Checkout'
        : 'Proceed to Checkout';
    }

    function toggleCart(open = false) {
      cartOverlay.classList.toggle('open',
        open || !cartOverlay.classList.contains('open'));
    }
    function toggleLogin(open = false) {
      loginOverlay.classList.toggle('open',
        open || !loginOverlay.classList.contains('open'));
    }

    // cart toggle events
    cartIcon.addEventListener('click', () => toggleCart());
    closeCart.addEventListener('click', () => toggleCart());
    cartOverlay.addEventListener('click', e => {
      if (e.target === cartOverlay) toggleCart();
    });

    // login/logout toggle
    loginBtn.addEventListener('click', () => {
      if (isLoggedIn) {
        // clear session
        isLoggedIn = false;
        currentUser = { email: '', name: '', rewards: 0 };
        usernameDisplay.textContent = 'Guest';
        rewardsDisplay.textContent = '0';
        loginBtn.textContent = 'Login';
        loginBtn.classList.remove('logout');
        checkoutBtn.disabled = true;
        checkoutBtn.textContent = 'Sign In to Checkout';
      } else {
        toggleLogin(true);
      }
    });
    closeLogin.addEventListener('click', () => toggleLogin());
    loginOverlay.addEventListener('click', e => {
      if (e.target === loginOverlay) toggleLogin();
    });

    // ---- HANDLE LOGIN ----
    loginForm.addEventListener('submit', async e => {
      e.preventDefault();
      const email = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;

      try {
        // GET user record by email+password
        const resp = await fetch(
          `${API.login}?email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`,
          { method: 'GET' }
        );
        if (!resp.ok) throw new Error('Invalid credentials or server error');
        const user = await resp.json();
        // expected user = { firstName, lastName, rewards }
        if (!user || !user.firstName) {
          throw new Error('No matching account found');
        }

        // update session state
        isLoggedIn = true;
        currentUser.email   = email;
        currentUser.name    = `${user.firstName} ${user.lastName}`;
        currentUser.rewards = user.rewards;

        // update UI
        usernameDisplay.textContent = currentUser.name;
        rewardsDisplay.textContent  = currentUser.rewards;
        loginBtn.textContent = 'Logout';
        loginBtn.classList.add('logout');
        checkoutBtn.disabled = false;
        checkoutBtn.textContent = 'Proceed to Checkout';

        loginForm.reset();
        toggleLogin(false);
      } catch (err) {
        alert(err.message);
      }
    });

    // ---- HANDLE CHECKOUT ----
    checkoutBtn.addEventListener('click', async () => {
      if (!cart.length) {
        alert('Your cart is empty.');
        return;
      }
      if (!isLoggedIn) {
        alert('Please sign in first.');
        return;
      }

      const payload = {
        user: {
          email: currentUser.email,
          name:  currentUser.name,
          rewards: currentUser.rewards
        },
        items: cart.map(i => ({ id: i.id, qty: i.qty }))
      };

      try {
        const resp = await fetch(API.checkout, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!resp.ok) throw new Error('Order submission failed');
        alert('Order submitted successfully!');
        cart = [];
        renderCart();
        toggleCart();
      } catch {
        alert('Network or server error during checkout.');
      }
    });

    document.addEventListener('DOMContentLoaded', renderProducts);
  </script>
</body>
</html>

